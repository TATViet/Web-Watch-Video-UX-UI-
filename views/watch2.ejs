<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OwlLoop ‚Äî Watch</title>

<style>
:root{
  --mobile-w:420px;
  --bg:#1f3326;
  --card:#2a4031;
  --muted:#b7c7bc;
  --accent:#88c273;
  --accent-2:#a6d39b;
  --radius:14px;
  font-family: Inter, system-ui, Arial;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
}

.container{
  width:100%;
  max-width:var(--mobile-w);
  min-height:100vh;
  padding:14px;
  background:var(--bg);
}

/* ===== ICON SYSTEM ===== */
.icon{
  width:20px;
  height:20px;
  stroke:#fff;
  stroke-width:2;
  fill:none;
}

.icon-btn{
  height:36px;
  padding:0 10px;
  border-radius:10px;
  background:rgba(255,255,255,.08);
  display:flex;
  align-items:center;
  gap:6px;
  font-size:13px;
  cursor:pointer;
}

/* ===== HEADER ===== */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:16px;
}

/* LOGO: full green */
.logo{
  width:44px;
  height:44px;
  border-radius:14px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
}

/* ===== PLAYING ===== */
.playing{
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
}

.playing-top{
  display:flex;
  justify-content:space-between;
  gap:10px;
}

.playing h3{
  margin:6px 0 4px;
  font-size:16px;
}

.channel{
  font-size:13px;
  color:var(--muted);
}

.auto{
  background:rgba(255,255,255,.08);
  padding:8px;
  border-radius:8px;
  font-size:13px;
  text-align:center;
  cursor:pointer;
}

.auto.on {
  background: var(--accent);
  color: #123;
}

/* ===== VIDEO ===== */
.video-wrap{
  margin-top:12px;
  background:#000;
  border-radius:12px;
  overflow:hidden;
}

.ad{
  background:#777;
  text-align:center;
  padding:14px;
  font-weight:700;
}

.video{
  position:relative;
  aspect-ratio:16/9;
}

.video iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
}

/* ===== CONTROLS ===== */
.controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:10px;
}

.control-group{
  display:flex;
  gap:10px;
}

/* ===== TAG ===== */
.tags{
  margin-top:8px;
  font-size:13px;
}

.tags .tag{
  padding:8px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  font-size:13px;
  cursor:pointer;
  display:inline-block;
}

/* ===== LIST ===== */
.list{
  margin-top:18px;
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
}

.item{
  display:flex;
  gap:12px;
  margin-bottom:12px;
  cursor:pointer;
  align-items: flex-start; /* Align top ƒë·ªÉ text d√†i kh√¥ng ·∫£nh h∆∞·ªüng thumbnail */
}

.thumb{
  width:80px;
  height:50px;
  border-radius:8px;
  overflow:hidden;
  position:relative;
  flex-shrink: 0; /* NgƒÉn thumbnail b·ªã co l·∫°i */
}

.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.item-info {
  flex: 1; /* Chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
  min-width: 0; /* Cho ph√©p co l·∫°i n·∫øu c·∫ßn */
}

.item-title{
  font-size:14px;
  font-weight:600;
  overflow: hidden; /* ·∫®n text tr√†n */
  text-overflow: ellipsis; /* Th√™m d·∫•u ... n·∫øu d√†i */
  display: -webkit-box;
  -webkit-line-clamp: 2; /* Gi·ªõi h·∫°n 2 d√≤ng */
  -webkit-box-orient: vertical;
  line-height: 1.2; /* ƒêi·ªÅu ch·ªânh line height */
}

.item-meta{
  font-size:12px;
  color:var(--muted);
  white-space: nowrap; /* Kh√¥ng wrap meta */
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== PREMIUM ===== */
.premium{
  margin-top:14px;
  border-top:1px solid rgba(255,255,255,.2);
  padding-top:10px;
  font-size:13px;
}

/* =======================
   FOCUS MODE (NEW)
======================= */

/* Overlay m·ªù to√†n trang */
#focusOverlay {
  position: fixed;
  inset: 0;
  z-index: 40;

  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(2px);

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

/* Video LU√îN n·ªïi tr√™n overlay */
.video-wrap,
.video-wrapper {
  position: relative;
  z-index: 60;
}

/* N√∫t ƒë√≥ng ‚ùå */
#focusClose {
  position: fixed;
  top: 10px;
  right: 12px;
  z-index: 70;

  width: 26px;
  height: 26px;
  border-radius: 50%;

  background: rgba(0,0,0,0.6);
  color: #fff;

  display: flex;
  align-items: center;
  justify-content: center;

  font-size: 14px;
  cursor: pointer;

  opacity: 0;
  pointer-events: none;
}

/* Khi b·∫≠t focus */
body.focus-mode #focusOverlay {
  opacity: 1;
  pointer-events: auto;
}

body.focus-mode #focusClose {
  opacity: 1;
  pointer-events: auto;
}

/* Shield active */
body.focus-mode #focusToggle {
  color: #2ecc71;
}

</style>
</head>
<body>

<div class="container">

<header>
  <div class="logo" onclick="location.href='/'" style="cursor:pointer;">ü¶â</div>

  <div style="display:flex; gap:8px;">
    <% if (!user) { %>
      <div class="icon-btn" onclick="location.href='/login'">
        <svg class="icon" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
        </svg>
        Login
      </div>
    <% } else { %>
      <div class="icon-btn" onclick="location.href='/account'">
        <svg class="icon" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4"/>
          <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
        </svg>
        <%= user.name %>
      </div>
    <% } %>

    <div class="icon-btn">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M4 4h16v16H4z"/>
        <path d="M4 6l8 6 8-6"/>
      </svg>
    </div>

    <div class="icon-btn">
      <svg class="icon" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="7"/>
        <line x1="21" y1="21" x2="16.5" y2="16.5"/>
      </svg>
    </div>
  </div>
</header>

<section class="playing">
  <div class="playing-top">
    <div>
      <div style="font-size:13px;color:#ccc">Playing</div>
      <h3>The Man That Makes Millionaires: Turn $0 to $10k With This Step By Step Formula! Alex Hormozi</h3>
      <div class="channel">Channel: The Diary Of A CEO
</div>
    </div>
    <div class="auto" onclick="toggleAuto(this)">Auto Switch<br><b>OFF</b></div>
  </div>

  <div class="video-wrap">
    <div class="ad">AD</div>

    <div class="video-wrapper">
      <div class="video">
        <iframe
          id="playerIframe"
          src="https://www.youtube-nocookie.com/embed/Kl-I7sUcAOY?enablejsapi=1"
          allowfullscreen>
        </iframe>
      </div>
    </div>

    <div class="ad">AD</div>
  </div>

  <div class="controls">
    <div class="control-group">
      <a href="/watch" class="icon-btn">
        <svg class="icon" viewBox="0 0 24 24">
          <polygon points="15,5 5,12 15,19"/>
        </svg>
      </a>

      <a href="/watch2" class="icon-btn">
        <svg class="icon" viewBox="0 0 24 24">
          <polygon points="9,5 19,12 9,19"/>
        </svg>
      </a>

      <!-- üõ°Ô∏è FOCUS BUTTON -->
      <div class="icon-btn" id="focusToggle" title="Focus mode">üõ°Ô∏è</div>
    </div>

    <div style="font-size:13px">Topic: Knowledge</div>
  </div>

  <div class="tags">
    Tag: <b class="tag" onclick="location.href='/topic/knowledge'">Knowledge</b>
  </div>
</section>

<section class="list">
  <h4>List of video</h4>

  <% if (videos && videos.length > 0) { %>
    <% videos.forEach(video => { %>
      <% 
        // Extract VIDEO_ID t·ª´ URL
        let videoId = '';
        if (video.url.includes('youtube.com/watch?v=')) {
          videoId = video.url.split('v=')[1].split('&')[0]; // L·∫•y ID t·ª´ full URL
        } else if (video.url.includes('youtu.be/')) {
          videoId = video.url.split('youtu.be/')[1].split('?')[0]; // L·∫•y ID t·ª´ short URL
        }
        const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : 'https://via.placeholder.com/80x50?text=No+Thumb'; // Placeholder n·∫øu kh√¥ng c√≥
      %>
      <div class="item" onclick="location.href='/watch?v=<%= encodeURIComponent(video.url) %>'">
        <div class="thumb">
          <img src="<%= thumbnailUrl %>" alt="<%= video.title %>">
        </div>
        <div class="item-info">
          <div class="item-title"><%= video.title %></div>
          <div class="item-meta"><%= video.duration %> ‚Ä¢ <%= video.channel || 'Unknown' %></div>
        </div>
      </div>
    <% }); %>
  <% } else { %>
    <p>No more videos available.</p>
  <% } %>

  <div class="premium">
    <b>Premium features</b>
    <ul>
      <li>No Ad</li>
      <li>Background play</li>
      <li>Detail Topic and Block, Favorite channel</li>
    </ul>
  </div>
</section>

</div>

<!-- OVERLAY CH·∫∂N CLICK (TR√äN C·∫¢ VIDEO) -->
<div id="focusOverlay"></div>

<!-- N√öT ƒê√ìNG (LU√îN CLICK ƒê∆Ø·ª¢C) -->
<div
  id="focusClose"
  style="
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    pointer-events: auto;
  "
>
  ‚úï
</div>

<script>
// Load YouTube API
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player;
function onYouTubeIframeAPIReady() {
  player = new YT.Player('playerIframe', {
    events: {
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerStateChange(event) {
  if (event.data == YT.PlayerState.ENDED) {
    if (localStorage.getItem('autoSwitch') === 'ON') {
      location.href = '/watch2';
    }
  }
}

  const focusBtn   = document.getElementById("focusToggle");
  const focusClose = document.getElementById("focusClose");
  const iframe     = document.getElementById("playerIframe");

  focusBtn.addEventListener("click", () => {
    document.body.classList.add("focus-mode");

    // üîí CH·∫∂N CLICK VIDEO (QUAN TR·ªåNG)
    iframe.style.pointerEvents = "none";
  });

  focusClose.addEventListener("click", () => {
    document.body.classList.remove("focus-mode");

    // üîì M·ªû L·∫†I CLICK VIDEO
    iframe.style.pointerEvents = "auto";
  });

  function toggleAuto(el) {
    const stateEl = el.querySelector('b');
    const currentState = stateEl.textContent;
    const newState = currentState === 'OFF' ? 'ON' : 'OFF';
    stateEl.textContent = newState;
    localStorage.setItem('autoSwitch', newState);
    el.classList.toggle('on', newState === 'ON');
  }

  // Kh√¥i ph·ª•c state t·ª´ localStorage khi load page
  window.addEventListener('load', () => {
    const autoEl = document.querySelector('.auto');
    const savedState = localStorage.getItem('autoSwitch') || 'OFF';
    autoEl.querySelector('b').textContent = savedState;
    if (savedState === 'ON') {
      autoEl.classList.add('on');
    }
  });
</script>

</body>
</html>